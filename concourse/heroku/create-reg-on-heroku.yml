platform: linux

image_resource:
  type: docker-image
  source:
    repository: psharkey/heroku-cli
    tag: "latest"

inputs:
- name: source

params:
  heroku_email:
  heroku_api_token:
  app_name:

run:
  path: sh
  dir: source
  args:
  - -exc
  - |
    cat > /root/.netrc <<EOF
     machine api.heroku.com
         login ${heroku_email}
         password ${heroku_api_token}
     machine git.heroku.com
         login ${heroku_email}
         password ${heroku_api_token}
     EOF
     export HEROKU_API_KEY=${heroku_api_token}
     git clone https://github.com/heroku/{app_name}.git
     heroku create
     heroku container:push web
     heroku container:release web -a ${app_name}

